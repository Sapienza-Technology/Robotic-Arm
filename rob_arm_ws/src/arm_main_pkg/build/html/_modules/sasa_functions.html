<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>sasa_functions &mdash; arm_2023 v1 documentation</title><link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../index.html" class="icon icon-home">
            arm_2023
              <img src="../_static/STT_Logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../usage.html">Usage</a></li>
<li class="toctree-l1"><a class="reference internal" href="../main_functions.html">Main Functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docker_setup.html">Docker Setup</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">arm_2023</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="index.html">Module code</a></li>
      <li class="breadcrumb-item active">sasa_functions</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for sasa_functions</h1><div class="highlight"><pre>
<span></span><span class="c1"># -*- coding: utf-8 -*-</span>
<span class="c1">#Definizione costanti e task</span>
<span class="kn">from</span> <span class="nn">array</span> <span class="kn">import</span> <span class="n">array</span>
<span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">string</span>
<span class="kn">from</span> <span class="nn">numpy.core.fromnumeric</span> <span class="kn">import</span> <span class="n">transpose</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span> 
<span class="kn">from</span> <span class="nn">math</span> <span class="kn">import</span> <span class="n">sin</span><span class="p">,</span> <span class="n">cos</span><span class="p">,</span> <span class="nb">pow</span><span class="p">,</span> <span class="n">atan2</span><span class="p">,</span> <span class="n">sqrt</span><span class="p">,</span> <span class="n">pi</span> 
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span> <span class="k">as</span> <span class="nn">m</span>
<span class="kn">from</span> <span class="nn">spatialmath</span> <span class="kn">import</span> <span class="n">SO3</span>

<span class="kn">from</span> <span class="nn">trajectory</span> <span class="kn">import</span> <span class="n">Trajectory</span>

<span class="c1">## Useful rotations ####################################################</span>
<div class="viewcode-block" id="Rx"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.Rx">[docs]</a><span class="k">def</span> <span class="nf">Rx</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>           <span class="p">,</span> <span class="mi">0</span>           <span class="p">],</span>
                    <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                    <span class="p">[</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]])</span></div>

<div class="viewcode-block" id="Ry"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.Ry">[docs]</a><span class="k">def</span> <span class="nf">Ry</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="n">m</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span>
                    <span class="p">[</span> <span class="mi">0</span>           <span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span>           <span class="p">],</span>
                    <span class="p">[</span><span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">,</span> <span class="n">m</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)]])</span></div>

<div class="viewcode-block" id="Rz"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.Rz">[docs]</a><span class="k">def</span> <span class="nf">Rz</span><span class="p">(</span><span class="n">theta</span><span class="p">):</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span> <span class="n">m</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="o">-</span><span class="n">m</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span> <span class="n">m</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">),</span> <span class="n">m</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="p">,</span> <span class="mi">0</span><span class="p">],</span>
                    <span class="p">[</span> <span class="mi">0</span>           <span class="p">,</span> <span class="mi">0</span>            <span class="p">,</span> <span class="mi">1</span><span class="p">]])</span></div>

<span class="c1">#####################################################################</span>
<span class="c1">## robot constants ##################################################</span>
<span class="c1">#####################################################################</span>
<span class="c1">## DH MATRIX</span>
<span class="c1">## alpha | a  | d  | theta</span>
<span class="c1">##---------------------------</span>
<span class="c1">##  pi/2 | a0 | d0 | q1</span>
<span class="c1">##    0  | l1 | 0  | q2</span>
<span class="c1">## -pi/2 | 0  | 0  | q3-pi/2</span>
<span class="c1">##  pi/2 | 0  | l2 | q4</span>
<span class="c1">## -pi/2 | 0  | 0  | q5</span>
<span class="c1">##    0  | 0  | ee | q6</span>
<span class="c1">#####################################################################</span>
<span class="c1">#####################################################################</span>
<span class="c1">### in metri</span>
<span class="n">a0</span><span class="o">=</span><span class="mf">0.0</span>
<span class="n">d0</span><span class="o">=</span><span class="mf">0.1070</span>
<span class="n">l1</span><span class="o">=</span><span class="mf">0.3475</span>
<span class="n">l2</span><span class="o">=</span><span class="mf">0.335</span> <span class="c1">#0.3420</span>
<span class="n">pirul</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.090</span>
<span class="n">maintenance</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.14</span>
<span class="n">base_offset</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.02</span> <span class="c1"># offset di base della pinza quando è chiusa</span>
<span class="n">high_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pi</span><span class="p">,</span> <span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">18</span><span class="p">])</span>         <span class="c1">#limiti alti dei primi tre giunti</span>
<span class="n">low_limits</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="o">-</span><span class="n">pi</span><span class="p">,</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">12</span><span class="p">,</span> <span class="o">-</span><span class="mi">17</span><span class="o">*</span><span class="n">pi</span><span class="o">/</span><span class="mi">18</span><span class="p">])</span>       <span class="c1">#limiti bassi dei primi tre giunti</span>
<span class="c1">#####################################################################</span>
<span class="c1">#####################################################################</span>
<span class="sd">&#39;&#39;&#39;</span>
<span class="sd">Funzioni principali</span>

<span class="sd">INVERSE KINEMATICS</span>
<span class="sd">inv_kin_total_bis è la funzione principale della inverse,</span>
<span class="sd">la inverse si compone di due fasi, una di posizionamento e una di orientamento:</span>
<span class="sd">  - il posizionamento viene fatto trovando i valori di q1 q2 q3, posizionando</span>
<span class="sd">    il centro del giunto sferico finale, a monte della rotazione del quarto giunto.</span>
<span class="sd">    La posizione per questa fase viene trovata spostando il punto di arrivo finale</span>
<span class="sd">    di un vettore [0,0,-ee] visto nel frame finale desiderato.</span>
<span class="sd">  - l&#39;orientamento viene realizzato grazie a q4 q5 q6, facendo si che la rotazione</span>
<span class="sd">    generata dagli ultimi quattro giunti, post-moltiplicata per la rotazione generata</span>
<span class="sd">    dai primi tre giunti (sempre a monte di q4), sia uguale alla rotazione desiderata</span>

<span class="sd">La prima fase viene fatta da inv_kin_bis, chiamata da inv_kin_bis_total.</span>
<span class="sd">Inoltre ci sono check matematici sulla realizzabilità della inverse</span>
<span class="sd">(che dipende dalla presenza della posa desidetata nel workspace del braccio) e check sui limiti </span>
<span class="sd">dei giunti, imposti a piacere rispetto ai limiti meccanici in range_check</span>

<span class="sd">DIRECT KINEMATICS</span>
<span class="sd">dir_kin_total si occupa della direct kinemaics, attraverso il formalismo di Denavith-Hartemberg.</span>
<span class="sd">Attraveso DH_universal_sim viene generata la matrice di roto-traslazione, per passare dal frame</span>
<span class="sd">dell&#39;end effector, a quello del base link, e viene dato in output la posizione in x y z nel base link.</span>

<span class="sd">dir_kin_total_with_rot fa la stessa cosa, ma ritorna anche la matrice di rotazione.</span>

<span class="sd">dir_kin ritorna la poszione intermedia determinata di primi tre giunti q1 q2 q3.</span>

<span class="sd">&#39;&#39;&#39;</span>
<div class="viewcode-block" id="inv_kin_bis"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.inv_kin_bis">[docs]</a><span class="k">def</span> <span class="nf">inv_kin_bis</span><span class="p">(</span><span class="n">coord</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span><span class="n">elbow</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span><span class="n">prec_qin</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Funzione ausiliaria di inv_kin_total_bis</span>
<span class="sd">    Fa la inverse_kin per una posizione intermedia, </span>
<span class="sd">    calcolando solo i valori dei primi tre giunti q1 q2 q3</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    coord : np.array posizione desiderata</span>
<span class="sd">    elbow : bool True se UP, False se DOWN</span>
<span class="sd">    prec_qin : np.array valori di giunto correnti (precedenti) q1 q2 q3</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : np.array valori di giunto calcolati q1 q2 q3</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">all_q0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">atan2</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="o">-</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])])</span>
    <span class="c1">#q0=atan2(coord[1],coord[0])</span>
    <span class="n">c2</span><span class="o">=</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span><span class="o">-</span><span class="n">a0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">d0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">l1</span><span class="o">*</span><span class="n">l2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="n">c2</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;out of workspace, try another movement&quot;</span><span class="p">)</span>
      <span class="c1">#new_pos = out_of_range_exeption(coord)</span>
      <span class="c1">#return inv_kin_bis(new_pos, elbow, prec_qin)</span>
      <span class="k">return</span> <span class="n">prec_qin</span>
    
    <span class="n">c2_minus</span><span class="o">=</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span><span class="o">+</span><span class="n">a0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">d0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">l1</span><span class="o">*</span><span class="n">l2</span><span class="p">)</span> <span class="c1">#c2 with minus sign</span>
    <span class="n">s2</span><span class="o">=</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">s2_minus</span><span class="o">=-</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>                              <span class="c1"># s2 with minus sign</span>
    <span class="n">all_q2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>                                      <span class="c1"># array containing all possible solutions </span>
    <span class="n">allA</span><span class="o">=</span><span class="p">[]</span><span class="c1">#np.array([[],[]])                                # array containign all possible A</span>
    <span class="n">allso</span><span class="o">=</span><span class="p">[]</span>                                                 <span class="c1"># array of all so</span>
    <span class="n">all_c2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">c2</span><span class="p">,</span><span class="n">c2_minus</span><span class="p">])</span>                           <span class="c1"># array with possible c2</span>
    <span class="n">all_s2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">s2</span><span class="p">,</span><span class="n">s2_minus</span><span class="p">])</span>                           <span class="c1"># array with possible s2</span>
    <span class="n">all_q1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>                                      
    <span class="k">for</span> <span class="n">q0</span> <span class="ow">in</span> <span class="n">all_q0</span><span class="p">:</span>                                    
      <span class="n">vec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">cos</span><span class="p">(</span><span class="n">q0</span><span class="p">)</span><span class="o">*</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sin</span><span class="p">(</span><span class="n">q0</span><span class="p">)</span><span class="o">*</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">a0</span><span class="p">],</span> <span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">d0</span><span class="p">]])</span>
      <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">all_c2</span><span class="p">:</span>                                         <span class="c1">#</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="n">all_s2</span><span class="p">:</span>                                       <span class="c1">#</span>
          <span class="n">q2</span><span class="o">=</span><span class="n">atan2</span><span class="p">(</span><span class="n">j</span><span class="p">,</span><span class="n">i</span><span class="p">)</span>                                        <span class="c1"># q2</span>
          <span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="o">*</span><span class="n">i</span><span class="p">,</span> <span class="o">-</span><span class="n">l2</span><span class="o">*</span><span class="n">j</span><span class="p">],</span> <span class="p">[</span><span class="n">l2</span><span class="o">*</span><span class="n">j</span><span class="p">,</span> <span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="o">*</span><span class="n">i</span><span class="p">]])</span>     <span class="c1"># A</span>
          <span class="n">so</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">vec</span><span class="p">)</span>                   <span class="c1"># so </span>
          <span class="n">c1</span><span class="o">=</span><span class="n">so</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>                                           <span class="c1"># </span>
          <span class="n">s1</span><span class="o">=</span><span class="n">so</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>                                           <span class="c1"># </span>
          <span class="n">q1</span><span class="o">=</span><span class="n">atan2</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">c1</span><span class="p">)</span>                                      <span class="c1">#   </span>
          <span class="n">allso</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">so</span><span class="p">)</span>                                     <span class="c1"># append so array                </span>
          <span class="n">allA</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">A</span><span class="p">)</span>                                       <span class="c1"># append A array</span>
          <span class="n">all_q2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_q2</span><span class="p">,</span> <span class="n">q2</span><span class="p">)</span>                         <span class="c1"># append q2 array</span>
          <span class="n">all_q1</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">all_q1</span><span class="p">,</span> <span class="n">q1</span><span class="p">)</span>                         <span class="c1"># append q1 array                       </span>
    <span class="n">all_q0</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">all_q0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">all_q0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">all_q0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">all_q0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">all_q0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">all_q0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">all_q0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">all_q0</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span>
    <span class="n">all_q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">all_q0</span><span class="p">,</span> <span class="n">all_q1</span><span class="p">,</span> <span class="n">all_q2</span><span class="p">])</span>
    <span class="n">q</span><span class="o">=</span><span class="n">best_qp</span><span class="p">(</span><span class="n">all_q</span><span class="p">,</span> <span class="n">elbow</span><span class="p">,</span> <span class="n">coord</span><span class="p">,</span> <span class="n">prec_qin</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">q</span></div>
    <span class="c1"># ora abbiamo tutti i possibili risultati di q2 A so q1 forse è necessario solo q1 e q2 vediamo come usarle</span>


<div class="viewcode-block" id="inv_kin_total_bis"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.inv_kin_total_bis">[docs]</a><span class="k">def</span> <span class="nf">inv_kin_total_bis</span><span class="p">(</span><span class="n">position</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">Rtarg</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">elbow</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">prec_q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">g_offset</span><span class="p">:</span><span class="nb">float</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    inv_kin_total_bis è la funzione principale della inverse,</span>
<span class="sd">    la inverse si compone di due fasi, una di posizionamento e una di orientamento:</span>
<span class="sd">      - il posizionamento viene fatto trovando i valori di q1 q2 q3, posizionando</span>
<span class="sd">        il centro del giunto sferico finale, a monte della rotazione del quarto giunto.</span>
<span class="sd">        La posizione per questa fase viene trovata spostando il punto di arrivo finale</span>
<span class="sd">        di un vettore [0,0,-ee] visto nel frame finale desiderato.</span>
<span class="sd">      - l&#39;orientamento viene realizzato grazie a q4 q5 q6, facendo si che la rotazione</span>
<span class="sd">        generata dagli ultimi quattro giunti, post-moltiplicata per la rotazione generata</span>
<span class="sd">        dai primi tre giunti (sempre a monte di q4), sia uguale alla rotazione desiderata</span>

<span class="sd">    La prima fase viene fatta da inv_kin_bis, chiamata da inv_kin_bis_total.</span>
<span class="sd">    Inoltre ci sono check matematici sulla realizzabilità della inverse</span>
<span class="sd">    (che dipende dalla presenza della posa desidetata nel workspace del braccio) e check sui limiti </span>
<span class="sd">    dei giunti, imposti a piacere rispetto ai limiti meccanici in range_check</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    position : np.array posizione desiderata</span>
<span class="sd">    Rtarg : np.matrix matrice di rotazione desiderata</span>
<span class="sd">    phase : bool True se pirulazione, False se maintenance</span>
<span class="sd">    elbow : bool True se UP, False se DOWN</span>
<span class="sd">    prec_q : np.array sei valori di giunto correnti (precedenti)</span>
<span class="sd">    g_offset : float larghezza corrente della pinza (se c&#39;è una pinza)</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q : np.array sei valori di giunto calcolati</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">prec_qfin</span> <span class="o">=</span> <span class="n">prec_q</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span>
    <span class="n">prec_qin</span>  <span class="o">=</span> <span class="n">prec_q</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span>

    <span class="n">current_offset</span> <span class="o">=</span> <span class="n">base_offset</span> <span class="o">+</span> <span class="n">g_offset</span><span class="o">/</span><span class="mi">2</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;current offset: &quot;</span><span class="p">,</span> <span class="n">current_offset</span><span class="p">)</span>
  

    <span class="n">Ptarg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">Rtarg</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">transpose</span><span class="p">()])</span>
    <span class="n">Ptarg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">([</span><span class="n">Ptarg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])])</span>
    <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
      <span class="n">dist_ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">current_offset</span><span class="p">,</span><span class="n">pirul</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">dist_ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">current_offset</span><span class="p">,</span><span class="n">maintenance</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rf3 e-e: &quot;</span><span class="p">,</span><span class="n">dist_ee</span><span class="p">)</span>
    <span class="n">pint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ptarg</span><span class="p">,</span> <span class="n">dist_ee</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Rf3 e-e: &quot;</span><span class="p">,</span><span class="n">pint</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pint</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">pint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pint</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">pint</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">pint</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">pint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pint</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pint</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pint</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">q</span><span class="o">=</span><span class="n">inv_kin_bis</span><span class="p">(</span><span class="n">pint</span><span class="p">,</span><span class="n">elbow</span><span class="p">,</span><span class="n">prec_qin</span><span class="p">)</span>
    <span class="c1">#print(&quot;dir kin intermedia:&quot;)</span>
    <span class="c1">#print(dir_kin(q))</span>
    <span class="c1">#print(&quot;dir kin voluta:&quot;)</span>
    <span class="c1">#print(pint)</span>
    <span class="c1">#print(&quot;\n&quot;)</span>
    <span class="n">q1</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">q2</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">q3</span><span class="o">=</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="n">Pint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a0</span> <span class="o">+</span> <span class="n">l2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">l1</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">))],</span>
                               <span class="p">[</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span>  <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">a0</span> <span class="o">+</span> <span class="n">l2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">l1</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">))],</span>
                               <span class="p">[</span>       <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">),</span>        <span class="mi">0</span><span class="p">,</span>         <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">),</span>           <span class="n">d0</span> <span class="o">+</span> <span class="n">l2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">l1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)],</span>
                               <span class="p">[</span>                   <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>                    <span class="mi">0</span><span class="p">,</span>                                           <span class="mi">1</span><span class="p">]]))</span>
    
    <span class="n">Rint</span> <span class="o">=</span> <span class="n">Pint</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">Rsol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Rint</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">Rtarg</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
      <span class="n">c5</span> <span class="o">=</span> <span class="n">Rsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">c5</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">c5</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">s5</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">c5</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
      <span class="n">q4</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">q4_minus</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="n">Rsol</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">q5</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">s5</span><span class="p">,</span><span class="n">c5</span><span class="p">)</span>
      <span class="n">q5_minus</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">s5</span><span class="p">,</span><span class="n">c5</span><span class="p">)</span>
      <span class="n">q6</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">Rsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">q6_minus</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
      <span class="n">q_op</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q4</span><span class="p">,</span><span class="n">q5</span><span class="p">,</span><span class="n">q6</span><span class="p">])</span>
      <span class="n">q_op_minus</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q4_minus</span><span class="p">,</span> <span class="n">q5_minus</span><span class="p">,</span> <span class="n">q6_minus</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;singularity&quot;</span><span class="p">)</span>
      <span class="n">q_op</span> <span class="o">=</span> <span class="n">prec_qfin</span>
      <span class="n">q_op_minus</span> <span class="o">=</span> <span class="n">prec_qfin</span>

    <span class="c1">#print(&quot;Ultime q: &quot;)</span>
    <span class="c1">#print(q_op)</span>
    <span class="c1">#print(q_op_minus)</span>
    <span class="c1">#print(&quot;\n&quot;)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">q_op</span><span class="o">-</span><span class="n">prec_qfin</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">q_op_minus</span><span class="o">-</span><span class="n">prec_qfin</span><span class="p">):</span>
      <span class="n">q4</span> <span class="o">=</span> <span class="n">q4_minus</span>
      <span class="n">q5</span> <span class="o">=</span> <span class="n">q5_minus</span>
      <span class="n">q6</span> <span class="o">=</span> <span class="n">q6_minus</span>

    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">q3</span><span class="p">,</span><span class="n">q4</span><span class="p">,</span><span class="n">q5</span><span class="p">,</span><span class="n">q6</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">q</span></div>

<div class="viewcode-block" id="dir_kin"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.dir_kin">[docs]</a><span class="k">def</span> <span class="nf">dir_kin</span><span class="p">(</span><span class="n">q</span> <span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span> <span class="p">:</span>    
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    Funzione ausiliaria per avere una direct kin intermedia, a valle dei primi tre giunti</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    q : np.array valori di q1 q2 q3 correnti</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    coord : np.array posizione intermedia</span>
<span class="sd">    &#39;&#39;&#39;</span>
    <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="n">a0</span><span class="o">+</span><span class="n">l1</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">l2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="n">a0</span><span class="o">+</span><span class="n">l1</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">l2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">z</span><span class="o">=</span><span class="n">d0</span><span class="o">+</span><span class="n">l1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="n">l2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">coord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">coord</span></div>

<div class="viewcode-block" id="dir_kin_total"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.dir_kin_total">[docs]</a><span class="k">def</span> <span class="nf">dir_kin_total</span><span class="p">(</span><span class="n">q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">q_gripper</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  dir_kin_total si occupa della direct kinemaics, attraverso il formalismo di Denavith-Hartemberg.</span>
<span class="sd">  Attraveso DH_universal_sim viene generata la matrice di roto-traslazione, per passare dal frame</span>
<span class="sd">  dell&#39;end effector, a quello del base link, e viene dato in output la posizione in x y z nel base link.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  q : np.array valori di giunto correnti</span>
<span class="sd">  phase : bool True se pirulazione, False se maintenance</span>
<span class="sd">  q_gripper : float larghezza corrente della pinza (se c&#39;è una pinza)</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  coord : np.array posizione in x y z nel base link</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">q1</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">q2</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">q3</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">q4</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">q5</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
  <span class="n">q6</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
  <span class="n">current_offset</span> <span class="o">=</span> <span class="n">base_offset</span> <span class="o">+</span> <span class="n">q_gripper</span><span class="o">/</span><span class="mi">2</span>

  <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="n">pirul</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="n">maintenance</span>

  <span class="n">DH</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>    <span class="n">a0</span><span class="p">,</span>      <span class="n">d0</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                  <span class="p">[</span>     <span class="mi">0</span><span class="p">,</span>    <span class="n">l1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                  <span class="p">[</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span>
                  <span class="p">[</span>  <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>      <span class="n">l2</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                  <span class="p">[</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
                  <span class="p">[</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="o">-</span><span class="n">ee</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]]])</span>
  
  <span class="n">A</span> <span class="o">=</span> <span class="n">DH_universal_sym</span><span class="p">(</span><span class="n">DH</span><span class="p">)</span>

  <span class="n">gripper_offset</span> <span class="o">=</span> <span class="n">A</span><span class="nd">@np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],[</span><span class="n">current_offset</span><span class="p">],[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">]])</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">gripper_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">gripper_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">gripper_offset</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

  <span class="n">coord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span> 
  <span class="k">return</span> <span class="n">coord</span></div>

<div class="viewcode-block" id="dir_kin_total_with_rot"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.dir_kin_total_with_rot">[docs]</a><span class="k">def</span> <span class="nf">dir_kin_total_with_rot</span><span class="p">(</span><span class="n">q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">phase</span><span class="p">,</span> <span class="n">q_gripper</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  dir_kin_total_with_rot si occupa della direct kinemaics, attraverso il formalismo di Denavith-Hartemberg.</span>
<span class="sd">  Attraveso DH_universal_sim viene generata la matrice di roto-traslazione, per passare dal frame</span>
<span class="sd">  dell&#39;end effector, a quello del base link, e viene dato in output la posizione in x y z nel base link </span>
<span class="sd">  e la matrice di rotazione.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  q : np.array valori di giunto correnti</span>
<span class="sd">  phase : bool True se pirulazione, False se maintenance</span>
<span class="sd">  q_gripper : float larghezza corrente della pinza (se c&#39;è una pinza)</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  rot : np.array matrice di rotazione</span>
<span class="sd">  coord : np.array posizione in x y z nel base link</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">q1</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">q2</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">q3</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">q4</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">q5</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
  <span class="n">q6</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
  <span class="n">current_offset</span> <span class="o">=</span> <span class="n">base_offset</span> <span class="o">+</span> <span class="n">q_gripper</span><span class="o">/</span><span class="mi">2</span>
  
  <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="n">pirul</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="n">ee</span> <span class="o">=</span> <span class="n">maintenance</span>

  <span class="n">DH</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span>  <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>    <span class="n">a0</span><span class="p">,</span>      <span class="n">d0</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                  <span class="p">[</span>     <span class="mi">0</span><span class="p">,</span>    <span class="n">l1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                  <span class="p">[</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">],</span>
                  <span class="p">[</span>  <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>      <span class="n">l2</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]],</span>
                  <span class="p">[</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]],</span>
                  <span class="p">[</span>     <span class="mi">0</span><span class="p">,</span>     <span class="mi">0</span><span class="p">,</span>     <span class="o">-</span><span class="n">ee</span><span class="p">,</span>    <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]]])</span>
  
  <span class="n">A</span> <span class="o">=</span> <span class="n">DH_universal_sym</span><span class="p">(</span><span class="n">DH</span><span class="p">)</span>

  <span class="n">gripper_offset</span> <span class="o">=</span> <span class="n">A</span><span class="nd">@np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="mi">0</span><span class="p">],[</span><span class="n">current_offset</span><span class="p">],[</span><span class="mi">0</span><span class="p">],[</span><span class="mi">1</span><span class="p">]])</span>

  <span class="n">rot</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>

  <span class="n">x</span> <span class="o">=</span> <span class="n">gripper_offset</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">gripper_offset</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">gripper_offset</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>

  <span class="n">coord</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span> 
  <span class="k">return</span> <span class="n">rot</span><span class="p">,</span> <span class="n">coord</span></div>


<span class="c1">#funzioni ausiliarie</span>
<div class="viewcode-block" id="range_check"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.range_check">[docs]</a><span class="k">def</span> <span class="nf">range_check</span><span class="p">(</span><span class="n">q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  range_check controlla che i valori di giunto siano all&#39;interno dei limiti imposti</span>
<span class="sd">  dai limiti meccanici del braccio</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  q : np.array valori di giunto correnti</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  res: True se i valori di giunto sono all&#39;interno dei limiti, False altrimenti</span>
<span class="sd">  bool_vec: np.array di 3 valori, 1 se il giunto è all&#39;interno dei limiti, 0 altrimenti</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="n">res</span> <span class="o">=</span> <span class="kc">True</span>  <span class="c1">#limiti</span>
  <span class="n">bool_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&lt;</span><span class="n">low_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">&gt;</span><span class="n">high_limits</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>      
    <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bool_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&lt;</span><span class="n">low_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="ow">or</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">&gt;</span><span class="n">high_limits</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bool_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&lt;</span><span class="n">low_limits</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="ow">or</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">&gt;</span><span class="n">high_limits</span><span class="p">[</span><span class="mi">2</span><span class="p">]:</span>
    <span class="n">res</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">bool_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="k">return</span> <span class="n">res</span><span class="p">,</span> <span class="n">bool_vec</span></div>

<div class="viewcode-block" id="best_qp"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.best_qp">[docs]</a><span class="k">def</span> <span class="nf">best_qp</span><span class="p">(</span><span class="n">all_q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">elbow</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">prec_qin</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  best_qp trova la soluzione di giunto che minimizza la distanza tra la posizione desiderata</span>
<span class="sd">  e quella calcolata nello spazio dei giunti</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  all_q : np.array matrice 3x8 con tutte le soluzioni di giunto</span>
<span class="sd">  elbow : bool True se UP, False se DOWN</span>
<span class="sd">  coord : np.array posizione desiderata</span>
<span class="sd">  prec_qin : np.array sei valori di giunto correnti (precedenti)</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  best : np.array tre migliori valori di giunto calcolati</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">best</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">q0</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">q1</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">q2</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="c1">#q0 = change_angle_for_j0(q0)</span>
    <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">])</span>
    <span class="c1">#print(q)  #to see all the possible solutions</span>
    <span class="n">res</span><span class="p">,</span> <span class="n">bool_vec</span> <span class="o">=</span> <span class="n">range_check</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">elbow</span> <span class="ow">and</span> <span class="n">q2</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">elbow</span> <span class="ow">and</span> <span class="n">q1</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">q2</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">and</span> <span class="n">res</span><span class="p">:</span>
    <span class="c1">#if res: </span>
      <span class="c1">#print(&quot;distances:&quot;)</span>
      <span class="c1">###coord_calc=dir_kin(q)</span>
      <span class="c1">#print(coord_calc)</span>
      <span class="c1">###dist = np.linalg.norm(coord-coord_calc)</span>
      <span class="c1">#print(coord)</span>
      <span class="c1">#print(coord - coord_calc)</span>
      <span class="c1">#print(dist)</span>
      <span class="c1">###best_dist= np.linalg.norm(coord-dir_kin(best))</span>
      <span class="c1">#print(best_dist)</span>
      <span class="c1">#print(&quot;\n&quot;)</span>
      <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">q</span><span class="o">-</span><span class="n">prec_qin</span><span class="p">)</span>
      <span class="n">best_dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">best</span><span class="o">-</span><span class="n">prec_qin</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">best_dist</span> <span class="o">&gt;</span> <span class="n">dist</span><span class="p">:</span>
        <span class="n">best_dist</span><span class="o">=</span><span class="n">dist</span>
        <span class="n">best</span><span class="o">=</span><span class="n">q</span>
      <span class="k">elif</span> <span class="n">best_dist</span><span class="o">==</span><span class="n">dist</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">best</span><span class="p">)</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="n">best</span><span class="o">=</span><span class="n">q</span>
  <span class="n">res</span><span class="p">,</span> <span class="n">bool_vec</span> <span class="o">=</span> <span class="n">range_check</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
    <span class="n">best</span> <span class="o">=</span> <span class="n">out_of_joint_range</span><span class="p">(</span><span class="n">all_q</span><span class="p">,</span> <span class="n">elbow</span><span class="p">,</span> <span class="n">coord</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">best</span></div>

<div class="viewcode-block" id="out_of_joint_range"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.out_of_joint_range">[docs]</a><span class="k">def</span> <span class="nf">out_of_joint_range</span><span class="p">(</span><span class="n">all_q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">elbow</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">coord</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  out_of_joint_range si occupa di trovare la soluzione di giunto che minimizza la distanza</span>
<span class="sd">  tra la posizione desiderata e quella calcolata nello spazio dei giunti, quando si è fuori</span>
<span class="sd">  dai limiti imposti dai limiti meccanici del braccio</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  all_q : np.array matrice 3x8 con tutte le soluzioni di giunto</span>
<span class="sd">  elbow : bool True se UP, False se DOWN</span>
<span class="sd">  coord : np.array posizione desiderata</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  best : np.array tre migliori valori di giunto calcolati (e eventualmente limitati)</span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">best</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">,</span> <span class="mi">2</span><span class="o">*</span><span class="n">pi</span><span class="p">])</span>
  
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">q0</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">q1</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">q2</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>

    <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">])</span>
    <span class="n">res</span><span class="p">,</span> <span class="n">bool_vec</span> <span class="o">=</span> <span class="n">range_check</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">((</span><span class="n">elbow</span> <span class="ow">and</span> <span class="n">q2</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="ow">not</span> <span class="n">elbow</span> <span class="ow">and</span> <span class="n">q1</span><span class="o">&lt;</span><span class="mi">0</span> <span class="ow">and</span> <span class="n">q2</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">))</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bool_vec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
    <span class="c1">#if np.sum(bool_vec) == 2:</span>
      <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bool_vec</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span><span class="o">-</span><span class="n">high_limits</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">q</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">high_limits</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">q</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span> <span class="o">=</span> <span class="n">low_limits</span><span class="p">[</span><span class="n">indx</span><span class="p">]</span>
      <span class="n">coord_calc</span><span class="o">=</span><span class="n">dir_kin</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
      <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord</span> <span class="o">-</span> <span class="n">coord_calc</span><span class="p">)</span>
      <span class="n">best_dist</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord</span><span class="o">-</span><span class="n">dir_kin</span><span class="p">(</span><span class="n">best</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">best_dist</span> <span class="o">&gt;</span> <span class="n">dist</span><span class="p">:</span>
        <span class="n">best_dist</span><span class="o">=</span><span class="n">dist</span>
        <span class="n">best</span><span class="o">=</span><span class="n">q</span>
      <span class="k">elif</span> <span class="n">best_dist</span><span class="o">==</span><span class="n">dist</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">best</span><span class="p">)</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="n">best</span><span class="o">=</span><span class="n">q</span>
  <span class="n">res</span><span class="p">,</span> <span class="n">bool_vec</span> <span class="o">=</span> <span class="n">range_check</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">res</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">best</span>
  
  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">8</span><span class="p">):</span>
    <span class="n">q0</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">q1</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">q2</span><span class="o">=</span><span class="n">all_q</span><span class="p">[</span><span class="mi">2</span><span class="p">][</span><span class="n">i</span><span class="p">]</span>
    <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">])</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;bad situation: you are out of joint limits&quot;</span><span class="p">)</span>
    <span class="n">res</span><span class="p">,</span> <span class="n">bool_vec</span> <span class="o">=</span> <span class="n">range_check</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
    <span class="c1">#if (elbow and q1&gt;0 and q2&lt;0) or (not elbow and q1&lt;0 and q2&gt;0) and range_check(q):</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">bool_vec</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
      <span class="n">indx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">bool_vec</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
      <span class="k">for</span> <span class="n">indx_v</span> <span class="ow">in</span> <span class="n">indx</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">q</span><span class="p">[</span><span class="n">indx_v</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
          <span class="n">q</span><span class="p">[</span><span class="n">indx_v</span><span class="p">]</span> <span class="o">=</span> <span class="n">high_limits</span><span class="p">[</span><span class="n">indx_v</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
          <span class="n">q</span><span class="p">[</span><span class="n">indx_v</span><span class="p">]</span> <span class="o">=</span> <span class="n">low_limits</span><span class="p">[</span><span class="n">indx_v</span><span class="p">]</span>
      <span class="n">coord_calc</span><span class="o">=</span><span class="n">dir_kin</span><span class="p">(</span><span class="n">q</span><span class="p">)</span>
      <span class="n">dist</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord</span> <span class="o">-</span> <span class="n">coord_calc</span><span class="p">)</span>
      <span class="n">best_dist</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">coord</span><span class="o">-</span><span class="n">dir_kin</span><span class="p">(</span><span class="n">best</span><span class="p">))</span>
      <span class="k">if</span> <span class="n">best_dist</span> <span class="o">&gt;</span> <span class="n">dist</span><span class="p">:</span>
        <span class="n">best_dist</span><span class="o">=</span><span class="n">dist</span>
        <span class="n">best</span><span class="o">=</span><span class="n">q</span>
      <span class="k">elif</span> <span class="n">best_dist</span><span class="o">==</span><span class="n">dist</span> <span class="ow">and</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">best</span><span class="p">)</span><span class="o">&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">q</span><span class="p">):</span>
        <span class="n">best</span><span class="o">=</span><span class="n">q</span>
  <span class="n">res</span><span class="p">,</span> <span class="n">bool_vec</span> <span class="o">=</span> <span class="n">range_check</span><span class="p">(</span><span class="n">best</span><span class="p">)</span>
  <span class="k">if</span> <span class="ow">not</span> <span class="n">res</span><span class="p">:</span>
    <span class="n">best</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
  <span class="k">return</span> <span class="n">best</span></div>



<span class="c1"># per andare dritti</span>
<div class="viewcode-block" id="go_straight"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.go_straight">[docs]</a><span class="k">def</span> <span class="nf">go_straight</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">elbow</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">q_pres</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">direct</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">q_gripper</span><span class="p">,</span> <span class="n">in_final_frame</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    go_straight si occupa di calcolare la cinematica inversa per andare dritti, in una direzione</span>
<span class="sd">    specificata, per una certa distanza, in un certo numero di passi.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    task : bool True se pirulazione, False se maintenance</span>
<span class="sd">    elbow : bool True se UP, False se DOWN</span>
<span class="sd">    q_pres : np.array sei valori di giunto correnti</span>
<span class="sd">    direct : string direzione in cui andare (l, r, u, d, f, b)</span>
<span class="sd">    steps : int numero di passi</span>
<span class="sd">    distance : float distanza da percorrere</span>
<span class="sd">    q_gripper : float larghezza corrente della pinza (se c&#39;è una pinza)</span>
<span class="sd">    in_final_frame : bool False se si vuole andare dritti nello spazio del base link, True se si vuole andare dritti nello spazio dell&#39;end effector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q_des : np.array sei valori di giunto calcolati</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="n">q_des</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;l&#39;</span><span class="p">:</span>    <span class="c1"># left</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span><span class="p">:</span>  <span class="c1"># right</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;u&#39;</span><span class="p">:</span>  <span class="c1"># up</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;d&#39;</span><span class="p">:</span>  <span class="c1"># down</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;f&#39;</span><span class="p">:</span>  <span class="c1"># front</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;b&#39;</span><span class="p">:</span>  <span class="c1"># back</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance</span><span class="o">/</span><span class="n">steps</span>

    <span class="n">rot</span><span class="p">,</span> <span class="n">coord</span> <span class="o">=</span> <span class="n">dir_kin_total_with_rot</span><span class="p">(</span><span class="n">q_pres</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">q_gripper</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Current pos in space: </span><span class="si">{</span><span class="n">coord</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
      <span class="n">pos_change_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="n">pos_change_vec</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_change</span>
      <span class="n">pos_delta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pos_change_vec</span><span class="p">])</span>
      <span class="k">if</span> <span class="n">in_final_frame</span><span class="p">:</span>
        <span class="n">pos_delta</span> <span class="o">=</span> <span class="n">rot</span><span class="nd">@pos_change_vec</span><span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
        <span class="c1">#print(&quot;vettori variazione pos:\n&quot;)</span>
        <span class="c1">#print(pos_change_vec)</span>
        <span class="c1">#print(pos_delta)</span>
        <span class="c1">#print(coord)</span>
        <span class="c1">#print(&quot;\n&quot;)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">shape</span><span class="p">(</span><span class="n">pos_delta</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_delta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_delta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_delta</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>
      <span class="k">else</span><span class="p">:</span>
        <span class="n">coord</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_delta</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_delta</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="n">pos_delta</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New pos in space: </span><span class="si">{</span><span class="n">coord</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="c1">#print(coord)</span>
      <span class="n">prec_q</span> <span class="o">=</span> <span class="n">q_pres</span>
      <span class="n">q_des</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inv_kin_total_bis</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">elbow</span><span class="p">,</span> <span class="n">prec_q</span><span class="p">,</span> <span class="n">q_gripper</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">q_des</span></div>
        
  
  
<span class="c1"># per ruotare</span>
<div class="viewcode-block" id="rotate"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.rotate">[docs]</a><span class="k">def</span> <span class="nf">rotate</span><span class="p">(</span><span class="n">task</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">elbow</span><span class="p">:</span><span class="nb">bool</span><span class="p">,</span> <span class="n">q_pres</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">direct</span><span class="p">:</span> <span class="n">string</span><span class="p">,</span> <span class="n">steps</span><span class="p">:</span><span class="nb">int</span><span class="p">,</span> <span class="n">distance</span><span class="p">,</span> <span class="n">q_gripper</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">in_final_frame</span><span class="p">:</span><span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">    rotate si occupa di calcolare la cinematica inversa per ruotare, in una direzione</span>
<span class="sd">    specificata, per una certa distanza, in un certo numero di passi.</span>
<span class="sd">    NOTA: in_final_frame non è consigliato per la rotazione, infatti è commentato</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    task : bool True se pirulazione, False se maintenance</span>
<span class="sd">    elbow : bool True se UP, False se DOWN</span>
<span class="sd">    q_pres : np.array sei valori di giunto correnti</span>
<span class="sd">    direct : string direzione in cui andare (r_cw, r_ccw, p_cw, p_ccw, y_cw, y_ccw)</span>
<span class="sd">    steps : int numero di passi</span>
<span class="sd">    distance : float distanza da percorrere</span>
<span class="sd">    q_gripper : float larghezza corrente della pinza (se c&#39;è una pinza)</span>
<span class="sd">    in_final_frame : bool False se si vuole andare dritti nello spazio del base link, True se si vuole andare dritti nello spazio dell&#39;end effector</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    q_des : np.array sei valori di giunto calcolati</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;entrato&quot;</span><span class="p">)</span>
    <span class="n">q_des</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;r_cw&#39;</span><span class="p">:</span>    <span class="c1"># roll cw</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;r_ccw&#39;</span><span class="p">:</span>  <span class="c1"># roll ccw</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;p_cw&#39;</span><span class="p">:</span>  <span class="c1"># pitch cw</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;p_ccw&#39;</span><span class="p">:</span>  <span class="c1"># pitch ccw</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">1</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;y_cw&#39;</span><span class="p">:</span>  <span class="c1"># yaw cw</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="n">distance</span><span class="o">/</span><span class="n">steps</span>
    <span class="k">elif</span> <span class="n">direct</span> <span class="o">==</span> <span class="s1">&#39;y_ccw&#39;</span><span class="p">:</span>  <span class="c1"># yaw ccw</span>
      <span class="n">s</span> <span class="o">=</span> <span class="mi">2</span>
      <span class="n">pos_change</span> <span class="o">=</span> <span class="o">-</span><span class="n">distance</span><span class="o">/</span><span class="n">steps</span>

    <span class="n">rot</span><span class="p">,</span> <span class="n">coord</span> <span class="o">=</span> <span class="n">dir_kin_total_with_rot</span><span class="p">(</span><span class="n">q_pres</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">q_gripper</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;partiamo da: &quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">coord</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">steps</span><span class="p">):</span>
      <span class="n">rot_change_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
      <span class="n">rot_change_vec</span><span class="p">[</span><span class="n">s</span><span class="p">]</span> <span class="o">=</span> <span class="n">pos_change</span>
      <span class="n">rot_delta_so3</span> <span class="o">=</span> <span class="n">SO3</span><span class="o">.</span><span class="n">RPY</span><span class="p">(</span><span class="n">rot_change_vec</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rot_change_vec</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">rot_change_vec</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
      <span class="n">rot_delta</span> <span class="o">=</span> <span class="n">rot_delta_so3</span><span class="o">.</span><span class="n">R</span>
<span class="w">      </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">      if in_final_frame:</span>
<span class="sd">        pos_delta = np.matmul(rot,pos_change_vec)</span>
<span class="sd">        #print(&quot;vettori variazione pos:\n&quot;)</span>
<span class="sd">        #print(pos_change_vec)</span>
<span class="sd">        #print(pos_delta)</span>
<span class="sd">        #print(coord)</span>
<span class="sd">        #print(&quot;\n&quot;)</span>
<span class="sd">      &#39;&#39;&#39;</span>
      <span class="c1">#rot = np.matmul(np.transpose(rot), rot_delta)</span>
      <span class="n">rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">rot</span><span class="p">,</span> <span class="n">rot_delta</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="n">rot_delta</span><span class="p">)</span>
      <span class="c1">#print(coord)</span>
      <span class="n">prec_q</span> <span class="o">=</span> <span class="n">q_pres</span>
      <span class="n">q_des</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">inv_kin_total_bis</span><span class="p">(</span><span class="n">coord</span><span class="p">,</span> <span class="n">rot</span><span class="p">,</span> <span class="n">task</span><span class="p">,</span> <span class="n">elbow</span><span class="p">,</span> <span class="n">prec_q</span><span class="p">,</span> <span class="n">q_gripper</span><span class="p">))</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="n">q_des</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">rot</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">q_des</span> </div>

<span class="c1"># Function we tried to use to compute time intervals for the trajectory</span>
<div class="viewcode-block" id="weighted_norm"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.weighted_norm">[docs]</a><span class="k">def</span> <span class="nf">weighted_norm</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="mi">6</span><span class="p">)):</span>
  <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">6</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;transpose: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Result: &quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">W</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span>
  <span class="k">return</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">W</span><span class="p">),</span> <span class="n">x</span><span class="p">))</span></div>





<span class="c1">#################### DH UNIVERSAL ####################</span>
<div class="viewcode-block" id="DH_universal_sym"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.DH_universal_sym">[docs]</a><span class="k">def</span> <span class="nf">DH_universal_sym</span><span class="p">(</span><span class="n">DH</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  DH_universal_sym si occupa di calcolare la matrice di roto-traslazione, attraverso il formalismo</span>
<span class="sd">  di Denavith-Hartemberg, a partire dalla tabella DH.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  DH : np.array tabella DH</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  A : np.array matrice di roto-traslazione </span>
<span class="sd">  &#39;&#39;&#39;</span>

  <span class="n">n</span><span class="p">,</span><span class="n">m</span> <span class="o">=</span> <span class="n">DH</span><span class="o">.</span><span class="n">shape</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">n</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">m</span> <span class="o">!=</span> <span class="mi">4</span><span class="p">:</span>
      <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You entered a wrong table&quot;</span><span class="p">)</span>
      <span class="k">return</span>

  <span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">eye</span><span class="p">(</span><span class="mi">4</span><span class="p">)</span>

  <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">):</span>
      <span class="n">Ai</span> <span class="o">=</span>  <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cos</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span>  <span class="n">sin</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">])],</span>
                      <span class="p">[</span><span class="n">sin</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span>  <span class="n">cos</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">]),</span> <span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">3</span><span class="p">])],</span>
                      <span class="p">[</span><span class="mi">0</span>           <span class="p">,</span>  <span class="n">sin</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>             <span class="p">,</span>  <span class="n">cos</span><span class="p">(</span><span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>             <span class="p">,</span> <span class="n">DH</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>             <span class="p">],</span>
                      <span class="p">[</span><span class="mi">0</span>           <span class="p">,</span>  <span class="mi">0</span>                        <span class="p">,</span>  <span class="mi">0</span>                        <span class="p">,</span> <span class="mi">1</span>                   <span class="p">]])</span>
      <span class="c1">#print(&quot;questo è Ai con indice&quot; + str(i) + &quot; :&quot;)</span>
      <span class="c1">#print(Ai)</span>
      <span class="n">A</span> <span class="o">=</span> <span class="n">A</span><span class="nd">@Ai</span>
  
  <span class="k">return</span> <span class="n">A</span></div>


<div class="viewcode-block" id="tf_camera_from_base"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.tf_camera_from_base">[docs]</a><span class="k">def</span> <span class="nf">tf_camera_from_base</span><span class="p">(</span><span class="n">q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  tf_camera_from_base si occupa di calcolare la matrice di roto-traslazione, attraverso il formalismo</span>
<span class="sd">  di Denavith-Hartemberg, a partire dai valori di giunto, per passare dal frame del base link, a quello</span>
<span class="sd">  della camera.</span>

<span class="sd">  Parameters</span>
<span class="sd">  ----------</span>
<span class="sd">  q : np.array valori di giunto correnti</span>

<span class="sd">  Returns</span>
<span class="sd">  -------</span>
<span class="sd">  camera_final : np.array matrice di roto-traslazione da camera_frame a base_frame</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="c1">#if request == &#39;03&#39;:</span>
  <span class="n">DH_table1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>     <span class="n">a0</span><span class="p">,</span>      <span class="n">d0</span><span class="p">,</span>        <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
                        <span class="p">[</span>    <span class="mi">0</span><span class="p">,</span>     <span class="n">l1</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>        <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                        <span class="p">[</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span>      <span class="mi">0</span><span class="p">,</span>       <span class="mi">0</span><span class="p">,</span>   <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">]])</span>



  <span class="c1">## we write at this point the rotation matrix throught the function DH_universal_syms</span>

  <span class="n">A</span> <span class="o">=</span> <span class="n">DH_universal_sym</span><span class="p">(</span><span class="n">DH_table1</span><span class="p">)</span>

  <span class="c1">#print(&quot;questo è A:&quot;)</span>
  <span class="c1">#print(A)</span>
  <span class="n">R_camera_to_3</span> <span class="o">=</span> <span class="n">Rz</span><span class="p">(</span><span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">2</span><span class="p">)</span>
  <span class="n">roto_tras_camera</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">((</span><span class="n">R_camera_to_3</span><span class="p">,[[</span><span class="o">-</span><span class="mf">0.065</span><span class="p">],[</span><span class="mi">0</span><span class="p">],[</span><span class="o">-</span><span class="mf">0.0125</span><span class="p">]])),[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">]))</span>
  <span class="c1">#print(&quot;questo è roto_tras_camera:&quot;)</span>
  <span class="c1">#print(roto_tras_camera)</span>
  <span class="n">camera_final</span> <span class="o">=</span> <span class="n">A</span><span class="nd">@roto_tras_camera</span>
  <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;questo è camera_final:&quot;</span><span class="p">)</span>
  <span class="nb">print</span><span class="p">(</span><span class="n">camera_final</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">camera_final</span></div>




<span class="c1">#per non buttare</span>
<span class="c1">#########################################################################################</span>
<span class="c1">#########################################################################################</span>
<span class="c1">#########################################################################################</span>

<div class="viewcode-block" id="out_of_range_exeption"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.out_of_range_exeption">[docs]</a><span class="k">def</span> <span class="nf">out_of_range_exeption</span><span class="p">(</span><span class="n">coord</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
<span class="w">  </span><span class="sd">&#39;&#39;&#39;</span>
<span class="sd">  Funzione per il check di fattibilità della inverse</span>
<span class="sd">  Vecchia funzione non usarla</span>
<span class="sd">  &#39;&#39;&#39;</span>
  <span class="c1">#y = sqrt(pow(l1+l2+0.05,2)/(pow(coord[0],2)/pow(coord[1],2) + pow(coord[2],2)/pow(coord[1],2) + 1))</span>
  <span class="c1">#if coord[1] &lt; 0:</span>
  <span class="c1">#  y = -y</span>
  <span class="c1">#x = y*coord[0]/coord[1]</span>
  <span class="c1">#z = y*coord[2]/coord[1]</span>
  <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span>
  <span class="n">x</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="n">ratio</span>
  <span class="n">y</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">ratio</span>
  <span class="n">z</span> <span class="o">=</span> <span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">ratio</span>
  <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">z</span><span class="p">])</span></div>

<div class="viewcode-block" id="inv_kin"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.inv_kin">[docs]</a><span class="k">def</span> <span class="nf">inv_kin</span><span class="p">(</span><span class="n">coord</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">)</span><span class="o">-&gt;</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">:</span>
    <span class="n">q0</span><span class="o">=</span><span class="n">atan2</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">c2</span><span class="o">=</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">m</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span><span class="mi">2</span><span class="p">))</span><span class="o">-</span><span class="n">a0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">+</span><span class="nb">pow</span><span class="p">(</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">d0</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">l1</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">l2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span><span class="o">/</span><span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">l1</span><span class="o">*</span><span class="n">l2</span><span class="p">)</span>
    <span class="n">s2</span><span class="o">=</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="nb">pow</span><span class="p">(</span><span class="n">c2</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
    <span class="n">q2</span><span class="o">=</span><span class="n">atan2</span><span class="p">(</span><span class="n">s2</span><span class="p">,</span><span class="n">c2</span><span class="p">)</span>            
    <span class="n">A</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="o">*</span><span class="n">c2</span><span class="p">,</span> <span class="o">-</span><span class="n">l2</span><span class="o">*</span><span class="n">s2</span><span class="p">],</span> <span class="p">[</span><span class="n">l2</span><span class="o">*</span><span class="n">s2</span><span class="p">,</span> <span class="n">l1</span><span class="o">+</span><span class="n">l2</span><span class="o">*</span><span class="n">c2</span><span class="p">]])</span>
    <span class="n">vec</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">([[</span><span class="n">cos</span><span class="p">(</span><span class="n">q0</span><span class="p">)</span><span class="o">*</span><span class="n">coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">+</span><span class="n">sin</span><span class="p">(</span><span class="n">q0</span><span class="p">)</span><span class="o">*</span><span class="n">coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">a0</span><span class="p">],</span> <span class="p">[</span><span class="n">coord</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">-</span><span class="n">d0</span><span class="p">]])</span>
    <span class="n">so</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="p">),</span><span class="n">vec</span><span class="p">)</span>
    <span class="n">c1</span><span class="o">=</span><span class="n">so</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">s1</span><span class="o">=</span><span class="n">so</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">q1</span><span class="o">=</span><span class="n">atan2</span><span class="p">(</span><span class="n">s1</span><span class="p">,</span><span class="n">c1</span><span class="p">)</span>
    <span class="n">q</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q0</span><span class="p">,</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">q</span></div>

<div class="viewcode-block" id="inv_kin_total"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.inv_kin_total">[docs]</a><span class="k">def</span> <span class="nf">inv_kin_total</span><span class="p">(</span><span class="n">position</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">Rtarg</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">,</span> <span class="n">phase</span><span class="p">):</span>
    <span class="n">Ptarg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">([</span><span class="n">Rtarg</span><span class="p">,</span> <span class="n">position</span><span class="o">.</span><span class="n">transpose</span><span class="p">()])</span>
    <span class="n">Ptarg</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">row_stack</span><span class="p">([</span><span class="n">Ptarg</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">])])</span>
    <span class="k">if</span> <span class="n">phase</span><span class="p">:</span>
      <span class="n">dist_ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">pirul</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="n">dist_ee</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">maintenance</span><span class="p">,</span><span class="mi">1</span><span class="p">])</span>

    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;dist_ee:</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">dist_ee</span><span class="p">)</span>
    <span class="n">pint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Ptarg</span><span class="p">,</span> <span class="n">dist_ee</span><span class="p">)</span>
    <span class="n">pint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pint</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span> <span class="n">pint</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span> <span class="n">pint</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">]])</span>
    <span class="n">q</span><span class="o">=</span><span class="n">inv_kin</span><span class="p">(</span><span class="n">pint</span><span class="p">)</span>
    <span class="n">q1</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">q2</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">q3</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">Pint</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matrix</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="o">-</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span>       <span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">81</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">59</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span><span class="o">/</span><span class="mi">200</span><span class="p">],</span>
                               <span class="p">[</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span>  <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">),</span>       <span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">81</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="mi">59</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="mi">4</span><span class="p">))</span><span class="o">/</span><span class="mi">200</span><span class="p">],</span>
                               <span class="p">[</span>        <span class="o">-</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">),</span>        <span class="mi">0</span><span class="p">,</span>         <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">),</span>    <span class="p">(</span><span class="mi">81</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">))</span><span class="o">/</span><span class="mi">200</span> <span class="o">+</span> <span class="p">(</span><span class="mi">59</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span><span class="o">/</span><span class="mi">200</span> <span class="o">+</span> <span class="mf">0.048826</span><span class="p">],</span>
                               <span class="p">[</span>                    <span class="mi">0</span><span class="p">,</span>        <span class="mi">0</span><span class="p">,</span>                    <span class="mi">0</span><span class="p">,</span>                                                      <span class="mi">1</span><span class="p">]]))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">Pint</span><span class="p">)</span>
    <span class="n">Rint</span> <span class="o">=</span> <span class="n">Pint</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">:</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">Rsol</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">matmul</span><span class="p">(</span><span class="n">Rint</span><span class="o">.</span><span class="n">transpose</span><span class="p">(),</span> <span class="n">Rtarg</span><span class="p">)</span>
    <span class="n">c5</span> <span class="o">=</span> <span class="n">Rsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">s5</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">c5</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">q4</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">],</span> <span class="o">-</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
    <span class="n">q5</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="n">s5</span><span class="p">,</span><span class="n">c5</span><span class="p">)</span>
    <span class="n">q6</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="o">-</span><span class="n">Rsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">],</span>  <span class="n">Rsol</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">q1</span><span class="p">,</span><span class="n">q2</span><span class="p">,</span><span class="n">q3</span><span class="p">,</span><span class="n">q4</span><span class="p">,</span><span class="n">q5</span><span class="p">,</span><span class="n">q6</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">q</span></div>

<span class="c1">## Time scaling</span>
<div class="viewcode-block" id="scale_traj"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.scale_traj">[docs]</a><span class="k">def</span> <span class="nf">scale_traj</span><span class="p">(</span><span class="n">Ti</span><span class="p">,</span> <span class="n">lim_vel</span><span class="p">):</span>
    <span class="n">max_vel</span> <span class="o">=</span> <span class="n">Ti</span><span class="o">.</span><span class="n">qd</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="n">min_vel</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">Ti</span><span class="o">.</span><span class="n">qd</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">max_vel</span> <span class="o">&lt;</span> <span class="n">min_vel</span><span class="p">:</span>
        <span class="n">mac_vel</span> <span class="o">=</span> <span class="n">min_vel</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">max_vel</span> <span class="o">/</span> <span class="n">lim_vel</span><span class="p">)</span>
    <span class="c1">#print(max_vel)</span>

    <span class="n">t</span> <span class="o">=</span> <span class="mi">1000</span><span class="o">*</span><span class="n">k</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="nb">int</span><span class="p">):</span>
            <span class="n">tscal</span> <span class="o">=</span> <span class="mf">1.0</span>
            <span class="n">ts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">t</span><span class="p">)</span>  <span class="c1"># normalized time from 0 -&gt; 1</span>
            <span class="n">tv</span> <span class="o">=</span> <span class="n">ts</span> <span class="o">*</span> <span class="n">t</span>
    <span class="c1">#print(tv)</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">qd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="n">qdd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">t</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">u</span> <span class="ow">in</span> <span class="n">tv</span><span class="p">:</span>
        <span class="n">u</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">u</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="n">t</span><span class="p">:</span>
            <span class="n">u</span> <span class="o">=</span> <span class="n">t</span><span class="o">-</span><span class="mi">1</span>

        <span class="n">original_indx</span> <span class="o">=</span> <span class="n">u</span> <span class="o">//</span> <span class="n">k</span>
        <span class="n">qd</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ti</span><span class="o">.</span><span class="n">qd</span><span class="p">[</span><span class="n">original_indx</span><span class="p">]</span><span class="o">/</span><span class="n">k</span>
        <span class="n">qdd</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ti</span><span class="o">.</span><span class="n">qdd</span><span class="p">[</span><span class="n">original_indx</span><span class="p">]</span><span class="o">/</span><span class="p">(</span><span class="n">k</span><span class="o">*</span><span class="n">k</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">u</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ti</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="k">elif</span> <span class="n">u</span><span class="o">%</span><span class="n">k</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">q</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">Ti</span><span class="o">.</span><span class="n">q</span><span class="p">[</span><span class="n">original_indx</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">q</span><span class="p">[</span><span class="n">u</span><span class="p">]</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="n">u</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">(</span><span class="n">qd</span><span class="p">[</span><span class="n">u</span><span class="p">]</span><span class="o">+</span><span class="n">qd</span><span class="p">[</span><span class="n">u</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">*</span><span class="mf">0.001</span><span class="o">/</span><span class="mi">2</span>
    
    <span class="c1">## definition of scaled trajectory</span>
    <span class="n">T_scaled</span> <span class="o">=</span> <span class="n">Trajectory</span><span class="p">(</span><span class="s1">&#39;miatrap&#39;</span><span class="p">,</span> <span class="n">tv</span><span class="p">,</span> <span class="n">q</span><span class="p">,</span> <span class="n">qd</span><span class="p">,</span> <span class="n">qdd</span><span class="p">)</span>
    <span class="n">T_scaled</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">T_scaled</span><span class="p">,</span> <span class="n">k</span></div>


<span class="c1">#converti valore per il giunto base nuovo</span>
<div class="viewcode-block" id="change_angle_for_j0"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.change_angle_for_j0">[docs]</a><span class="k">def</span> <span class="nf">change_angle_for_j0</span><span class="p">(</span><span class="n">angle</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">angle</span> <span class="o">&lt;</span> <span class="o">-</span><span class="n">pi</span><span class="o">/</span><span class="mi">4</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">angle</span> <span class="o">+</span> <span class="n">pi</span><span class="o">*</span><span class="mi">2</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">angle</span></div>


<span class="c1"># calibrazione</span>
<div class="viewcode-block" id="calibration"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.calibration">[docs]</a><span class="k">def</span> <span class="nf">calibration</span><span class="p">(</span><span class="n">psi</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">meas</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
  <span class="n">phi</span> <span class="o">=</span> <span class="n">eval_phi</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
  <span class="n">pos_nom</span> <span class="o">=</span> <span class="n">eval_pos</span><span class="p">(</span><span class="n">psi</span><span class="p">)</span>
  <span class="n">delta_pos</span> <span class="o">=</span> <span class="n">meas</span> <span class="o">-</span> <span class="n">pos_nom</span>
  <span class="n">pseudo_phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">pinv</span><span class="p">(</span><span class="n">phi</span><span class="p">)</span>
  <span class="n">delta_psi</span> <span class="o">=</span> <span class="n">pseudo_phi</span><span class="o">*</span><span class="n">delta_pos</span>
  <span class="n">new_psi</span> <span class="o">=</span> <span class="n">psi</span> <span class="o">+</span> <span class="n">delta_psi</span>
  <span class="k">if</span> <span class="n">delta_psi</span> <span class="o">&lt;=</span> <span class="mf">0.0001</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">new_psi</span>
  <span class="k">else</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">calibration</span><span class="p">(</span><span class="n">new_psi</span><span class="p">)</span></div>


<div class="viewcode-block" id="eval_phi"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.eval_phi">[docs]</a><span class="k">def</span> <span class="nf">eval_phi</span><span class="p">(</span><span class="n">psi</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
  <span class="n">alpha3</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">a1</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">a2</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">a4</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">d1</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
  <span class="n">d4</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
  <span class="n">d6</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

  <span class="n">q1</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">q2</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">q3</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">q4</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">q5</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
  <span class="n">q6</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

  <span class="n">alph</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))),</span>   <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)))</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)),</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)),</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)],</span>
                   <span class="p">[</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)),</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))),</span>   <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)),</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)],</span>
                   <span class="p">[</span>                                                                                                                                                                    <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)),</span>                                                                                                                                                                        <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)),</span>                                                                                                                          <span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">),</span>                                                                                                                                                                                                     <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)]])</span>
  <span class="n">alph</span> <span class="o">=</span> <span class="n">SO3</span><span class="p">(</span><span class="n">alph</span><span class="p">)</span>

  <span class="n">r_alpha_x</span> <span class="o">=</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r_alpha_y</span> <span class="o">=</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r_alpha_z</span> <span class="o">=</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r_alpha_rpy</span> <span class="o">=</span> <span class="n">alph</span><span class="o">.</span><span class="n">rpy</span><span class="p">()</span>
  <span class="n">r_alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_alpha_x</span><span class="p">,</span> <span class="n">r_alpha_y</span><span class="p">,</span> <span class="n">r_alpha_z</span><span class="p">,</span> <span class="n">r_alpha_rpy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_alpha_rpy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_alpha_rpy</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>

  <span class="n">r_a1_x</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
  <span class="n">r_a1_y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
  <span class="n">r_a1_z</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">r_a1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_a1_x</span><span class="p">,</span> <span class="n">r_a1_y</span><span class="p">,</span> <span class="n">r_a1_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

  <span class="n">r_a2_x</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
  <span class="n">r_a2_y</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
  <span class="n">r_a2_z</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
  <span class="n">r_a2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_a2_x</span><span class="p">,</span> <span class="n">r_a2_y</span><span class="p">,</span> <span class="n">r_a2_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

  <span class="n">r_a4_x</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span>
  <span class="n">r_a4_y</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span>
  <span class="n">r_a4_z</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span>
  <span class="n">r_a4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_a4_x</span><span class="p">,</span> <span class="n">r_a4_y</span><span class="p">,</span> <span class="n">r_a4_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

  <span class="n">r_d1_x</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">r_d1_y</span> <span class="o">=</span> <span class="mi">0</span>
  <span class="n">r_d1_z</span> <span class="o">=</span> <span class="mi">1</span>
  <span class="n">r_d1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_d1_x</span><span class="p">,</span> <span class="n">r_d1_y</span><span class="p">,</span> <span class="n">r_d1_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

  <span class="n">r_d4_x</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span>
  <span class="n">r_d4_y</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span>
  <span class="n">r_d4_z</span> <span class="o">=</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span>
  <span class="n">r_d4</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_d4_x</span><span class="p">,</span> <span class="n">r_d4_y</span><span class="p">,</span> <span class="n">r_d4_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

  <span class="n">r_d6_x</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r_d6_y</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r_d6_z</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r_d6</span><span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_d6_x</span><span class="p">,</span> <span class="n">r_d6_y</span><span class="p">,</span> <span class="n">r_d6_z</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>

  <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">column_stack</span><span class="p">(</span><span class="n">r_alpha</span><span class="p">,</span> <span class="n">r_a1</span><span class="p">,</span> <span class="n">r_a2</span><span class="p">,</span> <span class="n">r_a4</span><span class="p">,</span> <span class="n">r_d1</span><span class="p">,</span> <span class="n">r_d4</span><span class="p">,</span> <span class="n">r_d6</span><span class="p">)</span>

  <span class="k">return</span> <span class="n">phi</span></div>


<div class="viewcode-block" id="eval_pos"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.eval_pos">[docs]</a><span class="k">def</span> <span class="nf">eval_pos</span><span class="p">(</span><span class="n">psi</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">,</span> <span class="n">q</span><span class="p">:</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">):</span>
  <span class="n">alpha3</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">a1</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">a2</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">a4</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">d1</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
  <span class="n">d4</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>
  <span class="n">d6</span> <span class="o">=</span> <span class="n">psi</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span>

  <span class="n">q1</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
  <span class="n">q2</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
  <span class="n">q3</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
  <span class="n">q4</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
  <span class="n">q5</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span>
  <span class="n">q6</span> <span class="o">=</span> <span class="n">q</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span>

  <span class="n">Rot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([[</span><span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)),</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)),</span>   <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))],</span>
                    <span class="p">[</span><span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)),</span>   <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)))</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)),</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))],</span> 
                    <span class="p">[</span><span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">))</span> <span class="o">+</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)),</span>                                                                                                                              <span class="n">cos</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q6</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)),</span>                                                                                                   <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">))</span> <span class="o">-</span> <span class="n">sin</span><span class="p">(</span><span class="n">q2</span> <span class="o">+</span> <span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)]])</span>
  <span class="n">Rot</span> <span class="o">=</span> <span class="n">SO3</span><span class="p">(</span><span class="n">Rot</span><span class="p">)</span>
  <span class="n">r_rpy</span> <span class="o">=</span> <span class="n">Rot</span><span class="o">.</span><span class="n">rpy</span><span class="p">()</span>
  <span class="n">r_x</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r_y</span> <span class="o">=</span> <span class="n">a1</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d4</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q1</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r_z</span> <span class="o">=</span> <span class="n">d1</span> <span class="o">+</span> <span class="n">a2</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">a4</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span> <span class="o">+</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span> <span class="o">-</span> <span class="n">d6</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">alpha3</span><span class="p">)</span><span class="o">*</span><span class="n">cos</span><span class="p">(</span><span class="n">q3</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q2</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q4</span><span class="p">)</span><span class="o">*</span><span class="n">sin</span><span class="p">(</span><span class="n">q5</span><span class="p">)</span>
  <span class="n">r</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">r_x</span><span class="p">,</span> <span class="n">r_y</span><span class="p">,</span> <span class="n">r_z</span><span class="p">,</span> <span class="n">r_rpy</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">r_rpy</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">r_rpy</span><span class="p">[</span><span class="mi">2</span><span class="p">]])</span>
  
  <span class="k">return</span> <span class="n">r</span></div>

<span class="c1"># for maintenance - motion from Rtag</span>
<div class="viewcode-block" id="move_from_rtag"><a class="viewcode-back" href="../sasa_functions.html#sasa_functions.move_from_rtag">[docs]</a><span class="k">def</span> <span class="nf">move_from_rtag</span><span class="p">(</span><span class="n">cod</span><span class="p">,</span> <span class="n">q_pres</span><span class="p">,</span> <span class="n">steps</span><span class="p">):</span>
  <span class="k">if</span> <span class="n">cod</span> <span class="o">==</span> <span class="s1">&#39;main&#39;</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">go_straight</span><span class="p">(</span><span class="kc">False</span><span class="p">,</span> <span class="kc">True</span><span class="p">,</span> <span class="n">q_pres</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="n">steps</span><span class="p">,</span> <span class="mf">0.084</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span></div>


<span class="c1">######################################################################################</span>
<span class="c1">######################################################################################</span>
<span class="c1">######################################################################################</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2023, Antonio Bozza.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>  

  <style>
    /* Sidebar header (and topbar for mobile) */
    .wy-side-nav-search, .wy-nav-top {
      background: #F1C232;
    }
    /* Sidebar
    .wy-nav-side {
      background: #ff0000;
    } */
  </style>


</body>
</html>